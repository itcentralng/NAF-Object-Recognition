<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-compatible" content="IE=edge" />
    <meta name="author" content="Sunday Joseph" />
    <meta name="description" content="Section Viewer - Nigerian Air Force Museum" />
    <meta
      name="keywords"
      content="Nigerian Air Force, NAF, History, Military Aviation, Museum, Finance, NAFSFA"
    />

    <title id="page-title">Section Viewer - Nigerian Air Force Museum</title>
    <link
      rel="icon"
      href="images/Nigerian_Air_Force-Logo.wine 1.png"
      type="image/png"
    />
    <link rel="stylesheet" href="assets/css/utilities.css" />
    <link rel="stylesheet" href="assets/css/shared.css" />
    <link rel="stylesheet" href="assets/css/naf-history.css" />
  </head>
  <body class="flex justify-center align-start">
    <!-- Navigation Header -->
    <nav class="nav-header">
      <div class="nav-content">
        <button class="back-btn" onclick="window.history.back()">
          <span>‚Üê</span> Back to Museum
        </button>
        <div class="nav-title">
          <img src="images/Nigerian_Air_Force-Logo.wine 1.png" alt="NAF Logo" class="nav-logo" />
          <h2 id="nav-section-title">Section Viewer</h2>
        </div>
      </div>
    </nav>

    <div class="main-container" id="main-container">
      <!-- Section Overview Panel (Left Side) -->
      <div class="section-overview">
        <div class="overview-content">
          <div class="section-header">
            <div class="section-icon" id="section-icon">üõ©Ô∏è</div>
            <h1 class="section-title" id="section-title">Loading...</h1>
          </div>
          <p class="section-description" id="section-description">Loading section content...</p>
          <div class="section-summary">
            <h3>Section Overview</h3>
            <p id="section-summary-text">Loading summary...</p>
          </div>
          <div class="section-stats">
            <div class="stat-item">
              <span class="stat-number" id="total-years">0</span>
              <span class="stat-label">Years Covered</span>
            </div>
            <div class="stat-item">
              <span class="stat-number" id="total-events">0</span>
              <span class="stat-label">Historical Events</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Years Timeline Panel (Right Side) -->
      <div class="years-timeline">
        <div class="timeline-header">
          <h2>Historical Timeline</h2>
          <p>Select a year to explore its details</p>
        </div>
        <div class="years-container" id="years-container">
          <div class="loading-message">
            <p>Loading timeline...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Year Detail Modal -->
    <div class="year-detail-modal" id="year-detail-modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-year">1972</h2>
          <button class="close-btn" onclick="closeYearDetail()">√ó</button>
        </div>
        <div class="modal-body">
          <div class="year-overview">
            <h3 id="modal-title">Loading...</h3>
            <p id="modal-summary">Loading summary...</p>
          </div>
          
          <div class="year-content">
            <div class="content-section">
              <h4>Historical Context</h4>
              <p id="modal-content">Loading content...</p>
            </div>
            
            <div class="highlights-section">
              <h4>Key Highlights</h4>
              <div id="modal-highlights" class="highlights-grid">
                <!-- Highlights will be loaded dynamically -->
              </div>
            </div>
            
            <div class="activities-section">
              <h4>Major Activities & Events</h4>
              <ul id="modal-activities" class="activities-list">
                <!-- Activities will be loaded dynamically -->
              </ul>
            </div>
            
            <div class="images-section">
              <h4>Historical Images</h4>
              <div id="modal-images" class="images-gallery">
                <!-- Images will be loaded dynamically -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let currentSectionData = null;
      let selectedYear = null;

      // Get section ID from URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const sectionId = urlParams.get('section');

      if (!sectionId) {
        window.location.href = 'index.html';
      }

      // Load section data from JSON
      async function loadSectionData() {
        try {
          const response = await fetch('data.json');
          const data = await response.json();
          
          currentSectionData = data.sections.find(section => section.id === sectionId);
          
          if (!currentSectionData) {
            throw new Error('Section not found');
          }

          renderSectionOverview();
          renderYearsTimeline();
          
        } catch (error) {
          console.error('Error loading section data:', error);
          document.getElementById('main-container').innerHTML = 
            '<div class="error-message"><p>Error loading section content. Please try again.</p></div>';
        }
      }

      function renderSectionOverview() {
        // Update page title and navigation
        document.getElementById('page-title').textContent = `${currentSectionData.title} - Nigerian Air Force Museum`;
        document.getElementById('nav-section-title').textContent = currentSectionData.title;
        
        // Update overview panel
        document.getElementById('section-icon').textContent = currentSectionData.icon;
        document.getElementById('section-title').textContent = currentSectionData.title;
        document.getElementById('section-description').textContent = currentSectionData.description;
        document.getElementById('section-summary-text').textContent = currentSectionData.summary;
        
        // Update stats
        document.getElementById('total-years').textContent = currentSectionData.years.length;
        
        let totalEvents = 0;
        currentSectionData.years.forEach(year => {
          totalEvents += (year.highlights?.length || 0) + (year.activities?.length || 0);
        });
        document.getElementById('total-events').textContent = totalEvents;
      }

      function renderYearsTimeline() {
        const container = document.getElementById('years-container');
        let timelineHTML = '';

        currentSectionData.years.forEach((yearData, index) => {
          timelineHTML += `
            <div class="year-item" onclick="showYearDetail('${yearData.year}')" data-year="${yearData.year}">
              <div class="year-marker">
                <span class="year-number">${yearData.year}</span>
              </div>
              <div class="year-info">
                <h4 class="year-title">${yearData.title}</h4>
                <p class="year-summary">${yearData.summary}</p>
                <div class="year-meta">
                  <span class="highlight-count">${yearData.highlights?.length || 0} highlights</span>
                  <span class="activity-count">${yearData.activities?.length || 0} activities</span>
                </div>
              </div>
            </div>
          `;
        });

        container.innerHTML = timelineHTML;
      }

      function showYearDetail(year) {
        const yearData = currentSectionData.years.find(y => y.year === year);
        if (!yearData) return;

        selectedYear = yearData;
        
        // Update modal content
        document.getElementById('modal-year').textContent = yearData.year;
        document.getElementById('modal-title').textContent = yearData.title;
        document.getElementById('modal-summary').textContent = yearData.summary;
        document.getElementById('modal-content').textContent = yearData.content;
        
        // Update highlights
        const highlightsContainer = document.getElementById('modal-highlights');
        let highlightsHTML = '';
        if (yearData.highlights && yearData.highlights.length > 0) {
          yearData.highlights.forEach(highlight => {
            highlightsHTML += `
              <div class="highlight-item">
                <img src="${highlight.image}" alt="${highlight.title}" class="highlight-image" />
                <div class="highlight-content">
                  <h5>${highlight.title}</h5>
                  <p>${highlight.description}</p>
                </div>
              </div>
            `;
          });
        } else {
          highlightsHTML = '<p class="no-content">No highlights available for this year.</p>';
        }
        highlightsContainer.innerHTML = highlightsHTML;
        
        // Update activities
        const activitiesContainer = document.getElementById('modal-activities');
        let activitiesHTML = '';
        if (yearData.activities && yearData.activities.length > 0) {
          yearData.activities.forEach(activity => {
            activitiesHTML += `<li>${activity}</li>`;
          });
        } else {
          activitiesHTML = '<li class="no-content">No specific activities recorded for this year.</li>';
        }
        activitiesContainer.innerHTML = activitiesHTML;
        
        // Update images
        const imagesContainer = document.getElementById('modal-images');
        let imagesHTML = '';
        if (yearData.images && yearData.images.length > 0) {
          yearData.images.forEach(image => {
            imagesHTML += `
              <div class="gallery-item">
                <img src="${image}" alt="Historical Image from ${yearData.year}" class="gallery-image" />
              </div>
            `;
          });
        } else {
          imagesHTML = '<p class="no-content">No images available for this year.</p>';
        }
        imagesContainer.innerHTML = imagesHTML;
        
        // Show modal
        document.getElementById('year-detail-modal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // Add active state to year item
        document.querySelectorAll('.year-item').forEach(item => item.classList.remove('active'));
        document.querySelector(`[data-year="${year}"]`).classList.add('active');
      }

      function closeYearDetail() {
        document.getElementById('year-detail-modal').style.display = 'none';
        document.body.style.overflow = 'auto';
        
        // Remove active state from year items
        document.querySelectorAll('.year-item').forEach(item => item.classList.remove('active'));
        selectedYear = null;
      }

      // Close modal when clicking outside
      document.getElementById('year-detail-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeYearDetail();
        }
      });

      // Escape key to close modal
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && selectedYear) {
          closeYearDetail();
        }
      });

      // Initialize the section viewer
      loadSectionData();
    </script>
  </body>
</html>
